# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Описание возвожных категорий товара в карточке

```
export type categoryProduct = 
'софт-скил' | 
'другое' | 
'дополнительное' |
'кнопка' |
'хард-скил';
```

Карточка товара

```
export interface IProduct {
  id: string;
  description?: string;
  image:string;
  title:string;
  category: categoryProduct;
  price:number;
}
```

Cписок карточек товаров

```
export interface IProductList {
	total: number;
	items: IProduct[];
}
```

Каталог карточек товаров

```
export interface IProductsData {
  products: IProduct[];
  preview: string | null;
  getProduct(productId:string):IProduct | undefined; 
  setProducts(products: IProduct[]):void;
}
```

Корзина товаров содержит только необходимые поля для отображения

```
export type IProductBasket = Pick<IProduct,'id' | 'title'| 'price'>;
```

Управление корзиной товаров

```
export interface IProductBasketData {
  getProducts(): IProductBasket[];
  addProduct(product: IProductBasket): void;
  removeProduct(productId: string): void;
  clearBasket():void;
  getTotalPrice(): number;
  getCount(): number;
}
```

Возможные  способы оплаты

```
export type paymentMethod = 'online' | 'cash';
```

Информация о заказе

```
export interface IOrderInfo {
  payment: paymentMethod;
  address: string;
  email: string;
  phone: string;
}
```

Оформление заказа (шаг 1) содержит только необходимые поля для отображения

```
export type IOrderStep1 = Pick<IOrderInfo, 'payment'| 'address'>;
```

Оформление заказа (шаг 2) содержит только необходимые поля для отображения

```
export type IOrderStep2 = Pick<IOrderInfo, 'email'| 'phone'>;
```


Заказ

```
export interface IOrder extends IOrderInfo  {
  items: string[];
  total:number;
}
```

Тип ошибок при заполнении формы заказа

```
export type IFormErrors = Partial<Record<keyof IOrder, string>>;
```

Результат оформления заказа

```
export interface IOrderResult {
  id: string;
  total:number;
}
```

Оформления заказа

```
export interface IOrderData {
  order: IOrder;
  formErrors: IFormErrors;
  setFieldStep1(field:IOrderStep1): void;
  setFieldStep2(field:IOrderStep2): void;
  validationOrderStep1(field:Record<keyof IOrderStep1, string>):boolean;
  validationOrderStep2(field:Record<keyof IOrderStep2, string>):boolean;
  clearOrder():void;
}
```

## Архитектура приложения

Код приложения разделён на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице.
- слой данных, отвечает за хранение и изменение данных.
- презентер, отвечает за связь представления и данных.


### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передаётся базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер.
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется 'POST' запрос, но метод запроса может быть переопределён заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отпрравлять события и подписываться на события, происходящие в системе. Класс используется в презентере при обработке событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом 'IEvents':
- `on` - подписка на событие.
- `emit` - инициализация события.
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

#### Класс Model<T> 
Абстрактный класс Model служит базой для всех моделей данных в приложении. Он решает три ключевые задачи:
- предоставляет общий интерфейс для работы с данными
- обеспечивает механизм оповещения об изменениях через систему событий
- позволяет отличать модели от простых объектов данных
В конструктор передаются частичные данные (Partial<T>), что позволяет инициализировать модель с неполным набором данных, экземпляр системы событий (IEvents), через которую будут отправляться уведомления.
Метод `emitChanges` - основной механизм оповещения об изменениях.

#### Класс Component<T>
Абстрактный класс для создания UI-компонентов. Предоставляет:
- стандартизированную структуру компонентов
- набор готовых методов для работы с DOM
- типизированный интерфейс рендеринга
В конструктор передаётся корневой HTML-элемент компонента.
Методы:
- `render` - обновления компонента
- `toggleClass` - переключает CSS-класс
- `setText` - устанавливает текстовое содержимое
- `setDisabled` - управляет состоянием блокировки элемента
- `setHidden / setVisible` - управляет видимостью элемента
- `setImage` - устанавливает источник изображения

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными карточек товаров.\
Конструктор класса приниимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _Products: IProduct[] - массив объектов карточек товаров
- _preview: string | null - id карточки товаров, выбранной для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- getProduct(productId:string):IProduct | undefined - возвращает карточку по её id
- setProducts(products: IProduct[]):void - сохраняет данные карточек в классе
А так же сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс ProductBasketData
Класс отвечает за хранение и логику работы с данными карточек товаров в корзине.\
Конструктор класса приниимает инстант брокера событий.\
Так же класс предоставляет набор методов для взаимодействия с данными:
- getProducts(): IProductBasket[] - возвращает основные данные карточки, отображаемые в корзине
- addProduct(product: IProductBasket): void - добавляет один товар и вызывает событие изменения массива
- removeProduct(productId: string): void - удаляет один товар и вызывает событие изменения массива
- clearBasket():void - очистка корзины товаров
- getTotalPrice(): number - возвращает сумму всех товаров в корзине
- getCount(): number - возвращает количество товаров в корзине

### Класс OrderData
Класс отвечает за хранение и логику работы с данными карточек товаров в корзине.\
Конструктор класса приниимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- order: IOrder;
- formErrors: IFormErrors;
- events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- setFieldStep1(field:ICreatOrderStep1): void - сохраняет данные заказа на шаге 1 в классе
- setFieldStep2(field:ICreatOrderStep2): void - сохраняет данные заказа на шаге 2 в классе
- validationOrderStep1(field:Record<keyof IOrderStep1, string>):boolean - проверяет объект с данными (шаг 1) на валидность
- validationOrderStep2(field:Record<keyof IOrderStep2, string>):boolean - проверяет объект с данными (шаг 2) на валидность
- clearOrder():void -очистка данных заказа

### Классы представления
Все классы представления отвечают за оттображение внутри контейнера(DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна . Устанавливаает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик по оверлей и кнопку-крестик для закрытия.\
Конструктор класса приниимает селектор, по которому в разметке будет идентифицированно модальное окно и экземпляр класса `EventEmitter` для возможности инициации события.
В полях класса:
- _closeButton: HTMLButtonElement - кнопка-крестик модального окна
- _content: HTMLElement - контент модального окна

Так же класс предоставляет набор методов:
- render(data:IModalData)- обновление состояния модального окна
А так же сеттер для сохранения данных из поля класса.

#### Класс Form<T>
Класс является специализированным компонентом для работы с HTML-формами. Он решает ключевые задачи:
1. Управление состоянием формы:
- валидность данных
- ошибки валидации
- состояние кнопки отправки
2. Обработка пользовательских взаимодействий:
- изменение значений полей
- отправка формы
3. Интеграция с системой событий:
- уведомление об изменениях полей
- оповещение о попытке отправки
Конструктор класса приниимает корневой элемент формы (<form>) и экземпляр класса `EventEmitter` для возможности инициации события.
В полях класса:
- _submit: HTMLButtonElement - кнопка отправки 
- _errors: HTMLElement - контейнер для ошибок
Так же класс предоставляет набор методов:
- onInputChange(field: keyof T, value: string) - oбработчик изменений в полях формы
- render(state: Partial<T> & IFormState): HTMLFormElement - oбновление состояния формы
А так же сеттеры для сохранения данных из полей класса.

#### Класс Page
Класс является корневым компонентом страницы, отвечающим за управление основными UI-элементами страницы, обновление состояния интерфейса, координацию взаимодействия пользователя с ключевыми компонентами.
Конструктор класса приниимает корневой элемент страницы и экземпляр класса `EventEmitter` для возможности инициации события.
В полях класса:
- _counter: HTMLElement - счетчик товаров в корзине
- _catalog: HTMLElement - контейнер для карточек товаров
- _wrapper: HTMLElement - основная обертка страницы
- _basket: HTMLElement - иконка/кнопка корзины в шапке
Так же класс предоставляет сеттеры для сохранения данных из полей класса.

#### Класс Card
Отвечает за отображение карточки, задавая в карточке данные названия, изображения, описания, цена, кнопка. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
С помощью сеттеров сохраняем данные из полей классов.

#### Класс Basket
Класс реализует компонент корзины покупок, отвечающий за отображение списка добавленных товаров, расчет и показ общей стоимости, управление состоянием кнопки оформления заказа, обработку перехода к оформлению заказа.\
Конструктор класса приниимает корневой элемент страницы и экземпляр класса `EventEmitter` для возможности инициации события.\
В полях класса:
- _list: HTMLElement - контейнер для списка товаров
- _total: HTMLElement - элемент для отображения суммы
- _button: HTMLButtonElement - кнопка оформления заказа
А так же сеттеры для сохранения данных из полей класса.

#### Класс Success
Класс Success реализует компонент успешного завершения заказа, который отображает: подтверждение успешной операции, итоговую сумму списания, кнопку закрытия уведомления, обработку дальнейших действий пользователя.\
Конструктор класса приниимает корневой элемент страницы.\
В полях класса:
- _close: HTMLButtonElement - кнопка закрытия уведомления
- _total: HTMLElement - элемент для отображения суммы
А так же сеттер для oтображение итоговой суммы списания

#### Класс OrderStep1
Класс является специализированной реализацией формы заказа, которая: наследует базовую функциональность формы, предоставляет прямой доступ к полям ввода, упрощает предзаполнение данных пользователя, интегрируется с системой событий для обработки заказов.
Конструктор класса приниимает корневой элемент формы и экземпляр класса `EventEmitter` для возможности инициации события.\
В полях класса:
- paymentButtons: HTMLButtonElement[] - кнопки для выбора типа оплаты.
- addressInput: HTMLInputElement - поле ввода адресса
Так же класс предоставляет набор методов:
- outlinePayment(method: paymentMethod | null) - визуальное выделение активного способа оплаты
- render(state: Partial<IOrderStep1> & IForm): HTMLFormElement - oбновление состояния формы(переопределенный метод)
А так же сеттер для  установка значения адреса доставки

#### Класс OrderStep2
Класс является специализированной реализацией формы заказа, которая: наследует базовую функциональность формы, предоставляет прямой доступ к полям ввода, упрощает предзаполнение данных пользователя, интегрируется с системой событий для обработки заказов.
Конструктор класса приниимает корневой элемент формы и экземпляр класса `EventEmitter` для возможности инициации события.\
В полях класса:
- _emailInput: HTMLInputElement - поле ввода email
- _phoneInput: HTMLInputElement - поле ввода телефона
А так же сеттеры для  установки значений полей ввода


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `items:changed` - изменение списка товаров
- `basket:changed` - изменение содержимого корзины
- `preview:changed` - смена товара для предпросмотра
- `formErrors:change` - изменение ошибок валидации формы

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `basket:open` - открытие корзины покупок
- `order:open` - открытие формы заказа
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
