# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Описание возвожных категорий товара в карточке

```
export type categoryProduct = 
'софт-скил' | 
'другое' | 
'дополнительное' |
'кнопка' |
'хард-скил';
```

Карточка товара

```
export interface IProduct {
  id: string;
  description: string;
  image:string;
  title:string;
  category: categoryProduct;
  price:number | null;
}
```

Корзина товаров содержит только необходимые поля для отображения

```
export type TProductBasket = Pick<IProduct,'id' | 'title'| 'price'>;
```

Возможные  способы оплаты

```
export type paymentMethod = 'card' | 'cash' | '';
```

Информация о покупателе

```
export interface IUser {
  payment: paymentMethod;
  address: string;
  email: string;
  phone: string;
}
```

Заказ

```
export interface IOrder extends IUser  {
  items: string[];
  total:number;
}
```

Тип ошибок при заполнении формы заказа

```
export type TFormErrors = Partial<Record<keyof IOrder, string>>;
```

Результат оформления заказа

```
export interface IOrderResult {
  id: string;
  total:number;
}
```

## Архитектура приложения

Код приложения разделён на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице.
- слой данных, отвечает за хранение и изменение данных.
- презентер, отвечает за связь представления и данных.


### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передаётся базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер.
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется 'POST' запрос, но метод запроса может быть переопределён заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отпрравлять события и подписываться на события, происходящие в системе. Класс используется в презентере при обработке событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом 'IEvents':
- `on` - подписка на событие.
- `emit` - инициализация события.
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

#### Класс Component<T>
Абстрактный класс для создания UI-компонентов. Предоставляет:
- стандартизированную структуру компонентов
- набор готовых методов для работы с DOM
- типизированный интерфейс рендеринга
В конструктор передаётся корневой HTML-элемент компонента.
Методы:
- `render` - обновления компонента
- `toggleClass` - переключает CSS-класс
- `setText` - устанавливает текстовое содержимое
- `setDisabled` - управляет состоянием блокировки элемента
- `setHidden / setVisible` - управляет видимостью элемента
- `setImage` - устанавливает источник изображения

### Слой данных

#### Класс ProductCatalog
Класс отвечает за хранение и логику работы с данными карточек товаров.\
Конструктор класса приниимает инстанс брокера событий.\
В полях класса хранятся следующие данные:
- products: IProduct[] - актуальный список товаров.
- preview: string | null - id товара, выбранного для превью, либо null
- events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- getProducts(): IProduct[] - возвращает копию массива
- setProducts(products: IProduct[]):void - сохраняет массив товаров
- getProduct(id:string): IProduct | undefined - ищет товар по id
- setPreview(product:IProduct): void - устанавливает текущий товар-превью
- getPreview(): IProduct | null — возвращает объект товара для превью

#### Класс ProductBasket
Класс отвечает за набор выбранных товаров.\
Конструктор класса приниимает инстанс брокера событий.\
В поле класса хранятся следующие данные:
- products: IProduct[];
Так же класс предоставляет набор методов для взаимодействия с данными:
- getProducts(): TProductBasket[] -  массив позиций корзины
- addProduct(product: IProduct): void - добавляет один товар и вызывает событие изменения массива
- removeProduct(id: string): void - удаляет один товар и вызывает событие изменения массива
- clearBasket():void - очистка корзины товаров
- getTotal(): number - сумма всех товаров в корзине
- getCount(): number - количество товаров в корзине
- hasProduct(id: string): boolean - проверяет наличие товара

### Класс User
Класс отвечает за хранение данных покупателя, выполняет валидацию.\
Конструктор класса приниимает инстанс брокера событий.\
В полях класса хранятся следующие данные:
- user: IUser - данные введенные покупателем
- events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- setData(data: keyof IUser, value: string | paymentMethod	): void - обновляет любое поле заказа
- validationData():boolean - проводит валидацию всех полей
- clear():void -очистка данных заказа

### Классы представления
Все классы представления отвечают за оттображение внутри контейнера(DOM-элемент) передаваемых в них данных.

#### Класс Header
Класс отвечает  за отображение и обновление состояния корзины.\
Конструктор класса приниимает корневой элемент страницы и экземпляр класса `EventEmitter` для возможности инициации события.
В полях класса:
- counterElement: HTMLElement - счетчик товаров в корзине
- basketButton: HTMLButtonElement - иконка/кнопка корзины в шапке
Так же класс имеет сеттер для отображения данных счетчика.

#### Класс Gallery
Класс отвечает  за управление отображением каталога товаров на странице.\
Конструктор класса приниимает корневой элемент страницы и экземпляр класса `EventEmitter` для возможности инициации события.
В полях класса:
- catalogElement: HTMLElement - каталог товаров
Так же класс имеет сеттер для отображения данных каталога.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна, метод `fixed` - для фиксированного положения. Устанавливаает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик по оверлей и кнопку-крестик для закрытия.\
Конструктор класса принимает корневой элемент модального окна и экземпляр класса `EventEmitter` для возможности инициации события.
В полях класса:
- closeButton: HTMLButtonElement - кнопка-крестик модального окна
- contentElement: HTMLElement - контент модального окна
- pageWrapperElement: HTMLElement - 
Так же класс предоставляет ещё метод:
- render(data:IModalData)- обновление состояния модального окна
А так же сеттер для отображения данных контента.

#### Класс Card
Отвечает за отображение карточки, задавая в карточке данные названия и цены. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта и экземпляр `EventEmitter` для инициации событий и опционально объект с колбэком для вызова при клике.\
Поля класса содержат элементы разметки элементов карточки.\
С помощью сеттеров отображаем  данные из полей классов.

#### Класс CardCatalog
Расширяет класс Card. Предназначен для реализации карточки в каталоге товаров.
В полях класса:
- imageElement: HTMLImageElement - изображение товара
- categoryElement: HTMLElement - катогория товара\
А так же сеттеры для отображения данных полей класса

#### Класс CardPreview
Расширяет класс Card. Предназначен для реализации карточки в модальном окне.
В полях класса:
- imageElement: HTMLImageElement - изображение товара
- categoryElement: HTMLElement - катогория товара
- descriptionElement: HTMLElement - описание товара
- buttonElement: HTMLButtonElement - кнопка добавить/удалить\
А так же сеттеры для отображения данных полей класса

#### Класс CardBasket
Расширяет класс Card. Предназначен для реализации карточки в корзине.
В полях класса:
- indexElement : HTMLElement - номер товара в корзине
- buttonElement: HTMLButtonElement - кнопка удалить\
Так же класс предоставляет метод:\
- render(data?: Partial<TCardBasket>, index?: number): HTMLElement - oбновление состояния карточки
А так же сеттеры для отображения данных полей класса

#### Класс Form<T>
Реализует общий компонент формы. Предоставляет базовые методы и сеттеры для работы с отображнем элементов формы.\
Конструктор класса приниимает корневой элемент формы и экземпляр класса `EventEmitter` для возможности инициации события.
В полях класса:
- submitElement: HTMLButtonElement - кнопка отправки 
- errorsElement: HTMLElement - контейнер для ошибок
Так же класс предоставляет набор методов:
- onInputChange(field: keyof T, value: string) - oбработчик изменений в полях формы
- render(state: Partial<T> & IFormState): HTMLFormElement - oбновление состояния формы

#### Класс OrderForm
Класс реализует компонент формы отправки заказа.\
Конструктор класса приниимает корневой элемент формы и экземпляр класса `EventEmitter` для возможности инициации события.\
В полях класса:
- paymentCashElement: HTMLButtonElement - кнопка для выбора оплаты наличными
- paymentCardElement: HTMLButtonElement - кнопка для выбора оплаты картой
- addressInput: HTMLInputElement - поле ввода адресса\
А так же сеттеры для  отображения значений полей ввода

#### Класс ContactsForm
Класс реализует компонент формы контактов.\
Конструктор класса приниимает корневой элемент формы и экземпляр класса `EventEmitter` для возможности инициации события.\
В полях класса:
- emailElement: HTMLInputElement - поле ввода email
- phoneElement: HTMLInputElement - поле ввода телефона\
А так же сеттеры для  отображения значений полей ввода

#### Класс Basket
Класс реализует компонент корзины покупок, отвечающий за отображение списка добавленных товаров, показ общей стоимости, управление состоянием кнопки оформления заказа, обработку перехода к оформлению заказа.\
В конструктор класса передается DOM элемент темплейта и экземпляр класса `EventEmitter` для возможности инициации события.\
В полях класса:
- listElement: HTMLElement - контейнер для списка товаров
- totalElement: HTMLElement - элемент для отображения суммы
- buttonElement: HTMLButtonElement - кнопка оформления заказа\
А так же сеттеры для отображения данных из полей класса.

#### Класс Success
Класс Success реализует компонент успешного завершения заказа, который отображает: подтверждение успешной операции, итоговую сумму списания, кнопку закрытия уведомления, обработку дальнейших действий пользователя.\
Конструктор класса приниимает корневой элемент страницы.\
В полях класса:
- closeElement: HTMLButtonElement - кнопка закрытия уведомления
- totalElement: HTMLElement - элемент для отображения суммы\
А так же сеттер для oтображение итоговой суммы списания.


### Слой коммуникации

#### Класс WebLarekApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `products:changed` - изменение списка товаров
- `basket:changed` - изменение содержимого корзины
- `preview:changed` - смена товара для предпросмотра
- `formErrors:change` - изменение ошибок валидации формы

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `basket:open` - открытие корзины покупок
- `order:open` - открытие формы заказа
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `card:select` - выбор карточки
